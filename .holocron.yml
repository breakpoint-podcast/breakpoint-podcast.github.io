metadata:
  name: Подкаст «Breakpoint»
  description: Беседы о программной инженерии, мире ИТ и не только.
  authors: rkiyanchuk, ikalnitskyi, rpodoliaka
  url: https://breakpoint-podcast.github.io

pipes:
  compile:
    - name: import-processors
      imports:
        - episodes = episodes:process
        - welcome = welcome:process
      from_: "%(here)s/processors"

    - name: pipe
      pipe:
        - name: episodes
          repository: breakpoint-podcast/episodes
          enclosure: breakpoint-{tag_name}.mp3

        - name: commonmark

        - name: chain
          order_by: published_at
          direction: desc

        - name: welcome

    - name: when
      when:
        - item.source.match("episode://*")
      processor:
        name: feed
        syndication_format: rss
        feed:
          title:
            $ref: 'metadata:#/name'
          link:
            href:
              $ref: 'metadata:#/url'
          description:
            $ref: 'metadata:#/description'
          language: uk
          itunes_author:
            $ref: metadata:#/authors
          itunes_subtitle:
            $ref: 'metadata:#/description'
          itunes_category:
            - cat: Technology
              sub: Software How-To
            - cat: Technology
              sub: Tech News
          itunes_owner:
            name:
              $ref: metadata:#/authors
            email: ruslan.kiyanchuk+breakpoint@gmail.com
          itunes_image: https://breakpoint-podcast.github.io/static/itunes.png
          itunes_explicit: "no"
        item:
          id:
            $ref: item:#/url
          title:
            $ref: item:#/name
          content:
            $ref: item:#/content
          link:
            href:
              $ref: item:#/absurl
            rel: alternate
          enclosure:
            url:
              $ref: item:#/enclosure_url
            type:
              $ref: item:#/enclosure_type
            length:
              $ref: item:#/enclosure_size
          published:
            $ref: item:#/published_at
          itunes_duration:
            $ref: item:#/duration

    - name: when
      when:
        - item.source.match("episode://*") or item.source.match("welcome://")
      processor:
        name: jinja2
        template: episode.j2
        themes: ["%(here)s/theme"]

    - name: source
      path: favicon/

    - name: save
      to: _site
